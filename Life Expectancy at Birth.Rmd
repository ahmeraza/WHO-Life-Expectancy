---
title: 'Life Expectancy at Birth'
author: "Ahmed Raza"
date: "2025-02-13"
output:
  pdf_document: default
  html_document: default
---

## Loading Libraries & Datasets
```{r}
# Loading required libraries
library(tidyverse)
library(countrycode)

# Reading the Male Life Expectancy dataset
df_males <- read.csv("Males.csv", skip=4, stringsAsFactors=FALSE, check.names=TRUE)

# Reading the Female Life Expectancy dataset
df_females <- read.csv("Females.csv", skip=4, stringsAsFactors=FALSE, check.names=TRUE)

# To view column names
colnames(df_males)
colnames(df_females)
```

## Cleaning Both Datasets
```{r}
# Removing unnecessary columns
df_males <- df_males %>%
  select(-c(Indicator.Name, Indicator.Code, X, X2023))  

df_females <- df_females %>%
  select(-c(Indicator.Name, Indicator.Code, X, X2023))  

# Renaming columns to remove 'X' prefix from each year
colnames(df_males) <- gsub("^X", "", colnames(df_males))
colnames(df_females) <- gsub("^X", "", colnames(df_females))

# To view column names after cleaning
colnames(df_males)
colnames(df_females)
```
## Male and Female Life Expectancy Distributions
```{r}
# Histogram Plots for Males & Females
hist(df_males %>% select(where(is.numeric)) %>% unlist(),
     main = "Distribution of Life Expectancy (Males)",
     xlab = "Life Expectancy", col = "blue", breaks =30)

hist(df_females %>% select(where(is.numeric)) %>% unlist(),
     main = "Distribution of Life Expectancy (Females)",
     xlab = "Life Expectancy", col = "red", breaks = 30)
```

## Replacing Missing Values in Both Datasets with Median
```{r}
# Replacing the missing values with the median life expectancy for each country
df_males <- df_males %>%
  group_by(Country.Name) %>%
  mutate(across(where(is.numeric), ~ ifelse(is.na(.), median(., na.rm = TRUE), .))) %>%
  ungroup()

df_females <- df_females %>%
  group_by(Country.Name) %>%
  mutate(across(where(is.numeric), ~ ifelse(is.na(.), median(., na.rm = TRUE), .))) %>%
  ungroup()

# In order to handle any remaining NAs with the global median for each year
df_males <- df_males %>%
  mutate(across(where(is.numeric), ~ ifelse(is.na(.), median(., na.rm = TRUE), .)))

df_females <- df_females %>%
  mutate(across(where(is.numeric), ~ ifelse(is.na(.), median(., na.rm = TRUE), .)))

# Verifying if all the missing values were removed
sum(is.na(df_males))  
sum(is.na(df_females))  
```

## Changing from Wide (Original) to Long Format
```{r}
# Converting Males dataset to long format
df_males_long <- df_males %>%
  pivot_longer(cols = where(is.numeric), 
               names_to = "Year", 
               values_to = "Life_Expectancy_Male")

# Converting Females dataset to long format
df_females_long <- df_females %>%
  pivot_longer(cols = where(is.numeric), 
               names_to = "Year", 
               values_to = "Life_Expectancy_Female")

# Converting the Year column to numeric
df_males_long$Year <- as.numeric(df_males_long$Year)
df_females_long$Year <- as.numeric(df_females_long$Year)

# Checking to see whether the transformation was successful
head(df_males_long)
head(df_females_long)
```

## Merging Both Datasets
```{r}
# Merging the Males and Females datasets by Country, Country Code, and Year
df_combined <- merge(df_males_long, df_females_long, by = c("Country.Name", "Country.Code", "Year"))

# Checking to see if the merge was successful
head(df_combined)
```

## Adding Continent Information to Merged Dataset
```{r}
# Adding Continent information based on Country Code
df_combined$Continent <- countrycode(df_combined$Country.Code, "iso3c", "continent")

# Verifying whether the continents were assigned properly
head(df_combined)
```

## Saving the Cleaned & Merged Dataset
```{r}
# Saving the cleaned and merged dataset
write.csv(df_combined, "Merged_Life_Expectancy.csv", row.names = FALSE)
```

## Exploratory Data Analysis (EDA) & Further Cleaning
```{r}
# Checking basic summary statistics
summary(df_combined)

# Verifying if there are any remaining missing values
sum(is.na(df_combined))
```
```{r}
# Checking to see which columns have missing values
colSums(is.na(df_combined))
```
```{r}
# Seeing which countries do not have a continent assigned yet
df_missing_continent <- df_combined %>% filter(is.na(Continent)) %>% select(Country.Name, Country.Code) %>% distinct()
print(df_missing_continent)
```
```{r message=FALSE, warning=FALSE}
# Replacing the missing continent values with "Unclassifed"
df_combined$Continent[is.na(df_combined$Continent)] <- "Unclassifed"

# Verifying whether all the missing values were handled
sum(is.na(df_combined$Continent))  

# Checking the count of all the regions 
table(df_combined$Continent)
```

## Ethical Visualization (Blue Team)
```{r, message=FALSE, warning=FALSE,}
library(extrafont)
font_import()
loadfonts(device = "win") # For windows

ggplot(df_combined, aes(x = Year)) +
  geom_line(aes(y = Life_Expectancy_Male, color = "Male"), stat = "summary", fun = mean, linewidth = 1) +
  geom_line(aes(y = Life_Expectancy_Female, color = "Female"), stat = "summary", fun = mean, linewidth = 1) +
  facet_wrap(~ Continent) +  # Split by continent
    # Labels & Titles
  labs(
    title = "Life Expectancy Trends by Gender and Continent (1960â€“2022)",
    subtitle = "Analyzing trends in life expectancy for males and females across continents",
    x = "Year",
    y = "Life Expectancy (in Years)",
    color = "Gender",
    caption = "Source: World Bank Group"
  ) +
    theme_minimal(base_size = 13) + 
  theme(
    legend.position = "bottom",  # Move legend below the chart for better visibility
    legend.title = element_text(size = 12, face = "bold"),
    plot.title = element_text(face = "bold", size = 15, family = "Times New Roman"),
    plot.subtitle = element_text(size = 11, family = "Georgia", face = "italic"),
    plot.caption = element_text(size = 10, face = "italic", family = "Courier New"),
    panel.grid.major = element_line(color = "gray", linetype = "dashed"),  # Softer grid lines
    panel.grid.minor = element_blank(), # Remove unnecessary minor grid lines
    panel.spacing = unit(1.5, "lines"),
    axis.title = element_text(size = 12, family = "Arial"),  
    axis.title.x = element_text(margin = margin(t = 10)),
    axis.title.y = element_text(margin = margin(r =10)),
    axis.text = element_text(size = 10, face = "bold", family = "Courier New"),
    strip.text = element_text(face = "bold")
  )
  scale_color_manual(values = c("Male" = "steelblue", "Female" = "red")) 
```
**Write Up for the Ethical Visualization (Blue Team):**

This visualization clearly and ethically illustrates the changes in life expectancy for both men and women at birth across all continents from 1960 to 2022. Keeping in mind things like clarity and transparency, this visualization shows an unbiased, objective perspective without distortion. \newline
By categorizing the data by continent and showing yearly averages, this chart allows valuable regional comparisons while providing a balance and comprehensive overview. All data points were included and transformations such as filling in missing values with the median, dropping unnecessary columns, renaming columns, merging the Males and Females datasets, using the 'countrycode' package to classify each country by continent were performed. The citation is clearly provided (World Bank Group), enhancing credibility. \newline

The line chart format effectively displays long-term trends, and the color scheme (blue for males, red for females) is traditional, making interpretation easy. Another ethical advantage is the uniform Y-axis scale present on all continents, ensuring fair comparisons. If different scales had been used, the variations in life expectancy could have been inaccurately exaggerated. \newline

**This visualization follows the CRAP principles: ** \newline
**- Contrast:** The different colors for male (blue) and female (red) trends enhances readability, and the black title stands out against the white background.\newline
 
**- Repetition:** Having uniform fonts, grid lines, and axis labels show visual consistency throughout all aspects. \newline

**- Alignment:** The legend, title, and axis labels are placed with proper spacing, ensuring visual clarity. \newline

**- Proximity:** Organizing data by continent helps to see clear comparisons without confusion. \newline

This visualization improves understanding with a neutral, clear title, properly labeled axes, and a logically positioned legend. These components provide a precise, enlightening, and useful representation of global life expectancy patterns. This chart represents an ethical visualization free from misinterpretation. It also encourages the viewer to contemplate the social and healthcare elements affecting gender differences in life expectancy around the globe.\newline

## Unethical Visualization (Red Team)
```{r,message=FALSE, warning=FALSE}
# Unethical Visualization: Misleading Gender Comparison
ggplot(df_combined, aes(x = Year)) +
  geom_line(aes(y = Life_Expectancy_Male, color = "Male"), stat = "summary", fun = mean, linewidth = 1.5) +
  geom_line(aes(y = Life_Expectancy_Female, color = "Female"), stat = "summary", fun = mean, linewidth = 1.5) +
  facet_wrap(~ Continent) +
  labs(title = "Males are Falling Behind in Life Expectancy!",
       x = "Year", y = "Life Expectancy (in Years)", color = "Gender") +
  scale_y_continuous(limits = c(50, 85)) +  # Cuts off lower values to exaggerate gaps
  scale_color_manual(values = c("Male" = "black", "Female" = "pink")) +  # Biased color choices
  theme_minimal()

```
**Write Up for the Unethical Visualization (Red Team): **

The chart distorts numbers to depict gender differences in life expectancy. Although line graphs graphically represent trends well, this one purposely emphasizes the women's dominance. The use of black for males and pink for females serves to reinforce gender roles and makes the female line prominent because of width and lighter shades. This makes the masculine trend less prominent.\newline

One of the first challenges is that the Y-axis is being misused, beginning at 50 rather than 0. This creates differences in life expectancy for men and women appear greater than they actually are. Also, differences in uses of the Y-axis between continents have an effect on perception because some trends then appear more dramatic. These are decisions that cause observers to have the impression of men declining more quickly than is shown with evidence. This chart violates the CRAP principles of ethical design.\newline

**- Contrast:** The use of black for males and pink for females creates distracting and biased contrast that perpetuates gender stereotyping. The additional thickness on the part of females draws an inappropriate focus to females on the graph.\newline

**- Repetition:** Fonts and grid lines are repeated but uneven Y-axis scales for continents generate visual discord and confusion.\newline

**- Alignment:** The title and labels are aligned but their contents are altered intentionally to deceive the viewer.\newline

**- Proximity:** Information is separated into continents, yet free Y-axis scales render comparisons between regions of trends difficult.\newline

These design decisions are unethical, bringing down the integrity of the visualization and misleading the viewers. With its sensationalized contrasts, chosen color scheme, and inaccurate titles, this graph misrepresents the reality of gender difference in life expectancy. It fails to present a balanced or truthful presentation of the data, but instead encourages the user to infer from biased data.\newline



